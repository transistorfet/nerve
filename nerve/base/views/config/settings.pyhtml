<!DOCTYPE html PUBLIC "-//W3C/DTD HTML 4.01//EN">
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

    <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/theme.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/widgets.css" />

    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/widgets.js"></script>
    <script type="text/javascript" src="/assets/js/config.js"></script>
</head>
<body>

<div class="nerve-tabs">
    <div class="tab" data-content="/remote">Remote</div>
    <div class="tab" data-content="/medialib">Playlists</div>
    <div class="tab" data-content="/medialib/search">Media Search</div>
    <div class="tab" data-content="/datalog/graph">Datalogs</div>
    <div class="tab selected" data-content="/config">Config</div>
    <div style="clear: both;"></div>
</div>

<div id="nerve-notice" style="display: none;"></div>
<div id="nerve-error" style="display: none;"></div>

<div id="content">
    <%
    typeslist = nerve.query('/modules/get_types', nerve.Device)

    last_label = 0
    def treeview_object(dirname, expand=False):
        global last_label
        last_label += 1

        obj = nerve.get_object(dirname)

        %>
        <li class="directory"><input type="checkbox" id="<%= 'item-' + str(last_label) %>" <%= ' checked' if expand else '' %> />
        <label for="<%= 'item-' + str(last_label) %>"><%= dirname %><button class="object-delete" data-object="<%= dirname %>">x</button></label>
        <%

            %>
            <ul>
                <div id="nerve-notice" style="display: none;"></div>
                <div id="nerve-error" style="display: none;"></div>
            <%

            if hasattr(obj, '__type__'):
                %>
                <li><div class="nerve-form-item">
                    <label>Type</label>
                    <span><%= obj.__type__ %></span>
                </div></li>
                <%
            end

            config_info = obj.get_config_info().get_proper_names()
            for setting in config_info:
                if setting[2] in ('int', 'float', 'str', 'bool', 'textarea'):
                    %>
                    <li><div class="nerve-form-item">
                        <label><%= setting[1] %></label>
                        <span>
                            <% if setting[2] == 'bool': %>
                            <input type="checkbox" name="<%= setting[0] %>" value="1" <%= ' checked' if getattr(obj, setting[0]) else '' %> />
                            <% elif setting[2] == 'textarea': %>
                            <textarea name="<%= setting[0] %>"><%= getattr(obj, setting[0]) %></textarea>
                            <% else: %>
                            <input type="text" name="<%= setting[0] %>" value="<%= getattr(obj, setting[0]) %>" />
                            <% end %>
                        </span>
                    </div></li>
                    <%
                end
            end

            for setting in config_info:
                if setting[2] in ('list', 'tuple'):
                    output_list_treeview(getattr(obj, setting[0]), setting[0])
                elif setting[2] in ('dict',):
                    output_dict_treeview(getattr(obj, setting[0]), setting[0])
                end
            end

            if len(config_info) > 0:
                %>
                <button class="object-save" data-object="<%= dirname %>">Save</button>
                <div style="clear: both;"></div>
                <%
            end

            for name in sorted(obj.keys_children()):
                treeview_object(dirname + "/" + name)
            end
            %>
                <button class="add" data-object="<%= dirname %>">Add</button>
                <div style="display: none;">
                    <div id="nerve-notice" style="display: none;"></div>
                    <div id="nerve-error" style="display: none;"></div>
                    <div class="nerve-form-item-row">
                        <input type="text" name="__name__" />
                        <select class="add-select-type">
                            <option value="">(select type)</option>
                            <% for typename in typeslist: %>
                            <option value="<%= typename %>"><%= typename %></option>
                            <% end %>
                        </select>
                    </div>
                    <div id="add-settings"></div>
                    <div>
                        <button class="add-create" data-object="<%= dirname %>">Create</button>
                        <button class="add-cancel">Cancel</button>
                    </div>
                </div>
            <%

            %>
            </ul>
        </li>
        <%
    end

    def output_dict_treeview(obj, objname):
        global last_label
        last_label += 1

        if not obj:
            return
        end

        %>
        <li><input type="checkbox" id="<%= 'item-' + str(last_label) %>" /><label class="nerve-treeview alt-label" for="<%= 'item-' + str(last_label) %>"><%= objname %></label>
        <ul>
        <%

        for name in sorted(obj.keys()):
            if type(obj[name]) in [ int, float, str ]:
                %>
                <li><div class="nerve-form-item">
                    <label><%= name.capitalize() %></label>
                    <span><input type="text" name="<%= name %>" value="<%= obj[name] %>" /></span>
                </div></li>
                <%
            elif type(obj[name]) == dict:
                output_dict_treeview(obj[name], name)
            end
        end

        %>
        </ul></li>
        <%
    end

    def output_list_treeview(objectlist, objname):
        global last_label
        last_label += 1

        %>
        <li><input type="checkbox" id="<%= 'item-' + str(last_label) %>" /><label class="nerve-treeview alt-label" for="<%= 'item-' + str(last_label) %>"><%= objname %></label>
        <ul>
        <%

        for index, obj in enumerate(objectlist):
            if type(obj) in [ int, float, str ]:
                %>
                <li><div class="nerve-form-item">
                    <label><%= name.capitalize() %></label>
                    <span><input type="text" name="<%= index %>" value="<%= obj %>" /></span>
                </div></li>
                <%
            elif type(obj) == dict:
                output_dict_treeview(obj, index)
            end
        end

        %>
        </ul></li>
        <%
    end
    %>

    <h3>Modules</h3>
    <div class="nerve-treeview">
        <% for (name, enabled) in nerve.query('/modules/get_modules'): %>
        <div class="nerve-form-item">
            <label><%= name %></label>
            <input type="checkbox" name="<%= name %>" <%= ' checked' if enabled else '' %> />
        </div>
        <% end %>
        <button class="modules-save">Save</button>
    </div>
    <div style="clear: both;"></div>

    <h3>Devices</h3>
    <div class="nerve-treeview">
        <% treeview_object('/devices', True) %>
    </div>
    <div style="clear: both;"></div>

    <h3>Events</h3>
    <div class="nerve-treeview">
        <% treeview_object('/events', True) %>
    </div>
    <div style="clear: both;"></div>

    <% typeslist = nerve.query('/modules/get_types', nerve.Server) %>

    <h3>Servers</h3>
    <div class="nerve-treeview">
        <% treeview_object('/servers', True) %>
    </div>
    <div style="clear: both;"></div>
</div>

</body>
</html> 

