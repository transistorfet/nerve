<!DOCTYPE html PUBLIC "-//W3C/DTD HTML 4.01//EN">
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

    <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/theme.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/widgets.css" />

    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/widgets.js"></script>
</head>
<body>


<div class="nerve-tabs">
    <div class="tab" data-content="/remote">Remote</div>
    <div class="tab" data-content="/medialib">Playlists</div>
    <div class="tab" data-content="/medialib/search">Media Search</div>
    <div class="tab" data-content="/datalog/graph">Datalogs</div>
    <div class="tab selected" data-content="/config">Config</div>
    <div style="clear: both;"></div>
</div>

<hr>

<div id="nerve-notice" style="display: none;"></div>
<div id="nerve-error" style="display: none;"></div>

<div id="content">
    <%
    last_label = 0
    def output_object_treeview(object):
	global last_label

	if '__type__' not in object:
	    for i, name in enumerate(sorted(object.keys())):
		%>
		<li><input type="checkbox" id="<%= 'item-' + str(last_label) %>" checked /><label for="<%= 'item-' + str(last_label) %>"><%= name %></label>
		<ul>
		<%

		last_label += 1
		output_object_treeview(object[name])

		%>
		</ul></li>
		<%
	    end

	else:
	    config_info = nerve.ConfigObject.get_class_config_info(object['__type__'])

	    %>
	    <li><div class="nerve-form-item">
		    <label>Type</label>
		    <span><%= object['__type__'] %></span>
	    </div></li>
	    <%

	    for setting in config_info.get_proper_names():
		if type(object[setting[0]]) in [ int, float, str, unicode ]:
		    %>
		    <li><div class="nerve-form-item">
			<label><%= setting[1] %></label>
			<span><input type="text" name="<%= setting[0] %>" value="<%= object[setting[0]] %>" /></span>
		    </div></li>
		    <%
		end
	    end

	    for setting in config_info.get_proper_names():
		if type(object[setting[0]]) == dict:
		    %>
		    <li><input type="checkbox" id="<%= 'item-' + str(last_label) %>" checked /><label class="nerve-treeview alt-label" for="<%= 'item-' + str(last_label) %>"><%= setting[0] %></label>
		    <ul>
		    <%

		    last_label += 1
		    output_dict_treeview(object[setting[0]])

		    %>
		    </ul></li>
		    <%
		end
	    end
	end
    end

    def output_dict_treeview(object):
	global last_label

	for name in object.keys():
	    if type(object[name]) in [ int, float, str, unicode ]:
		%>
		<li><div class="nerve-form-item">
		    <label><%= name.capitalize() %></label>
		    <span><input type="text" name="<%= name %>" value="<%= object[name] %>" /></span>
		</div></li>
		<%
	    elif type(object[name]) == dict:
		%>
		<li><input type="checkbox" id="<%= 'item-' + str(last_label) %>" checked /><label class="nerve-treeview alt-label" for="<%= 'item-' + str(last_label) %>"><%= name %></label>
		<ul>
		<%

		last_label += 1
		output_dict_treeview(object[name])

		%>
		</ul></li>
		<%
	    end
	end
    end

    def output_list_treeview(objectlist):
	global last_label

	for index, object in enumerate(objectlist):
	    if type(object) in [ int, float, str, unicode ]:
		%>
		<li><div class="nerve-form-item">
		    <label><%= name.capitalize() %></label>
		    <span><input type="text" name="<%= index %>" value="<%= object %>" /></span>
		</div></li>
		<%
	    elif type(object[name]) == dict:
		%>
		<li><input type="checkbox" id="<%= 'item-' + str(last_label) %>" checked /><label for="<%= 'item-' + str(last_label) %>"><%= index %></label>
		<ul>
		<%

		last_label += 1
		output_dict_treeview(object[name])

		%>
		</ul></li>
		<%
	    end
	end

    end
    %>

    <div class="nerve-treeview">
	<ul>
	<% output_object_treeview(config_data) %>
	</ul>
    </div>
    <div style="clear: both;"></div>

    <button type="button" id="save">Save</button>
</div>

<script>

$(document).ready(function () {
    $('#save').click(function (e) {
	$.post('/config/save', { }, function (response) {
	    alert(response);
	}, 'json');
    });
});

</script>

</body>
</html> 
