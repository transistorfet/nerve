<!DOCTYPE html PUBLIC "-//W3C/DTD HTML 4.01//EN">
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

    <link rel="stylesheet" type="text/css" href="/assets/css/widgets.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/medialib.css" />

    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/widgets.js"></script>
</head>
<body>

<a name="top"></a>
<a href="/remote/index">Remote</a> | <a href="/remote/player">Player</a> | <a href="/medialib/">Playlists</a> | <a href="/medialib/search">Search Medialib</a> | <a href="/medialib/search_youtube">Search YouTube</a>
<hr>

<div id="notice" style="display: none;"></div>
<div id="error" style="display: none;"></div>

<div>
    <a href="/medialib/search?mode=artist">By Artist</a>
    <a href="/medialib/search?mode=album">By Album</a>
    <a href="/medialib/search?mode=genre&order=genre">By Genre</a>
    <a href="/medialib/search?mode=title&order=artist">By Title</a>
    <a href="/medialib/search?mode=album&order=modified">By Modified Date</a>
    <a href="/medialib/search?mode=album&recent=52">Most Recent</a>
    <a href="/medialib/search?mode=album&order=random">Random</a>
</div>

<div>
    <% for ch in range(ord('A'), ord('Z') + 1): %>
	<a href="/medialib/search?mode=title&order=artist&search=<%= chr(ch) %>%"><%= chr(ch) %></a>
    <% end %>
</div>

<div>
    <select id="mode">
	<option value="title" <%= ' selected' if mode == 'title' else '' %>>title</option>
	<option value="artist" <%= ' selected' if mode == 'artist' else '' %>>artist</option>
	<option value="album" <%= ' selected' if mode == 'album' else '' %>>album</option>
	<option value="genre" <%= ' selected' if mode == 'genre' else '' %>>genre</option>
    </select>

    <select id="media_type">
	<option value="" <%= ' selected' if not media_type else '' %>>any</option>
	<option value="audio" <%= ' selected' if media_type == 'audio' else '' %>>audio</option>
	<option value="video" <%= ' selected' if media_type == 'video' else '' %>>video</option>
    </select>

    <input type="text" id="recent" value="<%= recent if recent else '' %>">

    <br />

    <select id="order">
	<option value="artist" <%= ' selected' if order == 'artist' else '' %>>artist</option>
	<option value="album" <%= ' selected' if order == 'album' else '' %>>album</option>
	<option value="title" <%= ' selected' if order == 'title' else '' %>>title</option>
	<option value="genre" <%= ' selected' if order == 'genre' else '' %>>genre</option>
	<option value="tags" <%= ' selected' if order == 'tags' else '' %>>tags</option>
	<option value="modified" <%= ' selected' if order == 'modified' else '' %>>last modified</option>
	<option value="random" <%= ' selected' if order == 'random' else '' %>>random</option>
    </select>
    <input type="text" id="search" value="<%= search if search else '%%' %>">
    <button type="submit" id="pl_search" value="">Search</button>
</div>

<div id="search-table" style="display: none;">
    <hr>
    <div>
	<select id="select-playlist">
	<% for name in list_of_playlists: %>
	    <option value="<%= name %>"><%= name %></option>
	<% end %>
	</select>

	<button type="submit" class="pl_replace" value="1">Replace</button>
	<button type="submit" class="pl_enqueue" value="1">Enqueue</button>
    </div>

    <div id="search-results">
    </div>

    <button type="submit" class="pl_replace" value="1">Replace</button>
    <button type="submit" class="pl_enqueue" value="1">Enqueue</button>
    <a href="#top">Top</a>
</div>

<hr>

<script>

function search_medialib()
{
    var postvars = { };

    postvars['mode'] = $('#mode').val();
    postvars['order'] = $('#order').val();
    postvars['offset'] = $('#offset').val();
    postvars['limit'] = $('#limit').val();
    postvars['search'] = $('#search').val();
    postvars['recent'] = $('#recent').val();
    postvars['media_type'] = $('#media_type').val();

    $.post('/medialib/get_search_results', postvars, function (response) {
	$('#search-results').html(response);
	$('#search-table').show();
    }, 'html');
}

function expand_artist(artist)
{
    var postvars = { };
    postvars['mode'] = 'title';
    postvars['order'] = 'artist';
    postvars['search'] = artist;

    $.post("/medialib/get_search_results", postvars, function(response) {
	$('#search-results').html(response);
    }, 'html');
}

function add_tracks(method) {
    var postvars = { };
    postvars['method'] = method;
    postvars['playlist'] = $('#select-playlist').val();
    postvars['media'] = [ ];

    $("input[name='media']:checked").each(function () {
	postvars['media'].push($(this).val());
    });

    $.post('/medialib/add_tracks', postvars, function (response) {
	if (response.count === undefined || response.count <= 0) {
	    $('#error').html("No tracks were added").show();
	}
	else {
	    $('#notice').html(response.count + " track(s) were added to playlist " + postvars['playlist']).show();
	}
    }, 'json');
}

$(document).ready(function ()
{
    $('#pl_search').click(function () {
	$('#error').hide();
	$('#notice').hide();
	search_medialib();
    });

    $('.pl_enqueue').click(function () {
	add_tracks('enqueue');
    });

    $('body').delegate('.expand-artist', 'click', function () {
	expand_artist($(this).html());
    });
});

</script>

</body>
</html> 
 
